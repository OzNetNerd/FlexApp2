<!-- START TEMPLATE: macros/navigation.html -->

{#
  Template: navigation.html

  Provides utility macros for shared navigation items:
#}

{#
  • get_endpoint(item)
      Returns the Flask endpoint name for a given navigation item.
      – item.name : string identifier of the nav item (e.g. "settings", "relationships", "crisp_scores", or other blueprint prefix)
      Special-cases:
        • "settings"       → "settings_bp.index"
        • "relationships"  → "relationships_bp.index"
        • "crisp_scores"   → "crisp_scores_bp.index"
      Default:
        → "{item.name}_bp.index"
#}

{% macro get_endpoint(item) %}
  {% set item_name = (item.name if item is mapping and item.name is defined else item) | trim %}
  {%- if item_name == 'settings' %}
    {{- 'settings_bp.index' -}}
  {%- elif item_name == 'relationships' %}
    {{- 'relationships_bp.index' -}}
  {%- elif item_name == 'crisp_scores' %}
    {{- 'crisp_scores_bp.index' -}}
  {%- else %}
    {{- item_name + '_bp.index' -}}
  {%- endif %}
{% endmacro %}

{#

  • is_active(item)
      Returns a boolean indicating whether the current request endpoint matches the navigation item.
      – Checks for exact match on index endpoints for special cases ("settings", "relationships", "crisp_scores")
      – Otherwise, checks if request.endpoint starts with "{item.name}_bp."
#}

{% macro is_active(item) %}
  {% set item_name = item.name if item is mapping and item.name is defined else item %}
  {%- if item_name == 'settings' %}
    {{- request.endpoint == 'settings_bp.index' -}}
  {%- elif item_name == 'relationships' %}
    {{- request.endpoint == 'relationships_bp.index' -}}
  {%- elif item_name == 'crisp_scores' %}
    {{- request.endpoint == 'crisp_scores_bp.index' -}}
  {%- else %}
    {{- request.endpoint and request.endpoint.startswith(item_name + '_bp.') -}}
  {%- endif %}
{% endmacro %}

{#
  • get_url(item)
      Returns the URL for a nav item's index using url_for().
      – Mirrors the same special-casing as get_endpoint:
        • "settings"       → url_for("settings_bp.index")
        • "relationships"  → url_for("relationships_bp.index")
        • "crisp_scores"   → url_for("crisp_scores_bp.index")
      – Default:
        → url_for("{item.name}_bp.index")
#}

{% macro get_url(item) %}
  {# Get item name and clean it of problematic characters #}
  {% set raw_item_name = (item.name if item is mapping and item.name is defined else item) | trim %}
  {% set item_name = raw_item_name | replace('[', '') | replace(']', '') | replace('\n', '') | replace('{', '') | replace('}', '') %}

  {% if item_name == '' %}
    {{- url_for('home_bp.index') -}}
  {%- elif item_name == 'settings' %}
    {{- url_for('settings_bp.index') -}}
  {%- elif item_name == 'relationships' %}
    {{- url_for('relationships_bp.index') -}}
  {%- elif item_name == 'crisp_scores' %}
    {{- url_for('crisp_scores_bp.index') -}}
  {%- else %}
    {{- url_for(item_name + '_bp.index') -}}
  {%- endif %}
{% endmacro %}

<!-- END TEMPLATE: macros/navigation.html -->