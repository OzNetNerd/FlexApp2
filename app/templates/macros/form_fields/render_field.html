{#
  ------------------------------------------------------------------------------
  File: form_field_macros.html
  Purpose:
    Defines a reusable macro system for rendering form fields in a consistent
    card-based layout. Supports both editable and read-only states, using
    imported macros to separate logic and layout cleanly.

  Imports:
    - render_input.html  ‚Üí input_macros: Renders editable form inputs
    - render_value.html  ‚Üí value_macros: Renders read-only field values

  Macros:
    - render_field(field, read_only=False)
        Renders a Bootstrap-styled card for each field with header, content,
        required indicator, and help text (if present).

  Structure:
    - Bootstrap card with light border and subtle shadow
    - Card header: field label and optional "Required" badge
    - Card body: input or value depending on mode
    - Help text: shown only in editable mode

  Notes:
    - Uses `namespace(render_field=...)` to expose macro in Jinja contexts
    - Logging embedded to assist with debugging field rendering
  ------------------------------------------------------------------------------
#}

{% import "macros/form_fields/render_input.html" as input_macros %}
{% import "macros/form_fields/render_value.html" as value_macros %}

<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";

  const filename = "form_field_macros.html";
  log("info", filename, "init", "üì¶ Loaded form field rendering macros");
  log("debug", filename, "import", "üîó Imported macros: input_macros (render_input.html), value_macros (render_value.html)");
</script>

{% macro render_field(field, read_only=False) %}
  <script type="module">
    import log from "{{ url_for('static', filename='js/logger.js') }}";

    const filename = "form_field_macros.html";
    const fieldName = {{ field.name | tojson | safe }};
    const fieldLabel = {{ field.label | tojson | safe }};
    const isReadOnly = {{ (read_only or field.readonly) | tojson }};
    const isRequired = {{ field.required | tojson }};

    log("debug", filename, "render_field", `üõ† Rendering field '${fieldName}' (label: '${fieldLabel}')`);
    log("debug", filename, "render_field", "üìå Mode", isReadOnly ? "read-only" : "editable");
    log("debug", filename, "render_field", "‚≠ê Required", isRequired);
  </script>

  <div class="col-md-6 mb-3">
    <div class="card border-light h-100 shadow-sm">
      <div class="card-header bg-light d-flex justify-content-between align-items-center py-2">
        <span class="fw-bold">{{ field.label }}</span>
        {% if field.required and not read_only %}
          <span class="badge bg-danger text-white ms-2">Required</span>
        {% endif %}
      </div>
      <div class="card-body">
        {% if not read_only and not field.readonly %}
          {{ input_macros.render_input(field) }}
          {% if field.help_text %}
            <div class="form-text text-muted mt-2">
              <i class="fas fa-info-circle me-1"></i> {{ field.help_text }}
            </div>
          {% endif %}
        {% else %}
          {{ value_macros.render_value(field) }}
        {% endif %}
      </div>
    </div>
  </div>
{% endmacro %}

{# Expose macro using a namespace so templates can do: field.render_field(...) #}
{% set field = namespace(render_field=render_field) %}

<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";
  const filename = "form_field_macros.html";
  log("info", filename, "namespace", "üß¨ Exposed macro as 'field.render_field'");
</script>
