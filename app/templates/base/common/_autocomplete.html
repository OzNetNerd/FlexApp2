{#
  base/common/_autocomplete.html - Dynamic form template with tabbed interface

  This template renders a tabbed interface for creating, viewing, or editing data.
  It dynamically generates form fields based on the 'ui' structure provided and
  includes autocomplete functionality via main.js.

  Context variables:
    - ui: A nested structure containing tabs, sections, and form entries
    - model_name: String representing the model being created/edited
    - error_message: Optional error message to display
    - macros: Object containing the render_field macro for form field generation

  Template inheritance:
    - Extends _create_view_edit.html base template
    - Includes _footer_buttons.html for form submission controls

  Dependencies:
    - Requires main.js for autocomplete functionality
    - Uses toasts.js for error notifications
#}

{% extends "create_view_edit/components/_create_view_edit.html" %}

{% block content %}
  <div class="tab-content">
    {% for tab in ui %}
      <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
           id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
           role="tabpanel"
           aria-labelledby="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab">
        {% for section in tab.sections %}
          <h5 class="mt-3">{{ section.section_name }}</h5>
          <div class="row">
            {% for entry in section.entries %}
              {{ macros.render_field(entry) }}
            {% endfor %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  {# Include footer component #}
  {% include 'create_view_edit/components/_footer_buttons.html' %}

  {# Add the main.js script which will handle autocomplete functionality #}
  <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>

  {# If there's an error, show a toast message using toasts.js #}
  {% if error_message %}
    <script type="module">
      import { showToast } from "/static/js/toasts.js";
      document.addEventListener('DOMContentLoaded', () => {
        const message = {{ ("Error creating " ~ model_name ~ ": " ~ error_message) | tojson }};
        showToast(message, "error");
      });
    </script>
  {% endif %}
{% endblock %}