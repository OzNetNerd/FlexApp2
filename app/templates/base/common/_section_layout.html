<!-- START TEMPLATE: _pills_nav_content.html -->
{# ------------------------------------------------------------------------------
  File: _pills_nav_content.html
  Purpose: Tabbed content layout using pre-defined ui tabs
  Inputs:
    - ui: List[Tab]
    - read_only: Boolean
------------------------------------------------------------------------------ #}

{% import "macros/form_fields/render_field.html" as macros %}

<div class="tab-content">
  {% for tab in ui %}
    <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
         id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
         role="tabpanel"
         aria-labelledby="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab">

      {% for section in tab.sections %}
        {% if section.section_name %}
          <h5 class="mt-3">{{ section.section_name }}</h5>
        {% endif %}

        <div class="row">
          {% for entry in section.entries %}
            {% if entry.entry_name and entry.label %}
              {{ macros.render_field({
                'name': entry.entry_name,
                'label': entry.label,
                'type': entry.type,
                'required': entry.required,
                'readonly': entry.readonly,
                'options': entry.options,
                'value': entry.value if entry.value is defined else entry.default
              }) }}
            {% else %}
              <div class="col-md-6 mb-3">
                <div class="alert alert-warning">
                  ‚ö†Ô∏è Invalid field entry in section "{{ section.section_name }}"
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endfor %}
    </div>
  {% endfor %}
</div>

<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";

  const tabNames = {{ ui | map(attribute='tab_name') | list | tojson | safe }};
  const structure = [
    {% for tab in ui %}
      {
        tab: {{ tab.tab_name | tojson }},
        sectionCount: {{ tab.sections | length }},
        entryCounts: {
          {% for section in tab.sections %}
            {{ section.section_name | tojson }}: {{ section.entries | length }}{% if not loop.last %},{% endif %}
          {% endfor %}
        }
      }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];

  log("info", "_pills_nav_content.html", "render", "üìã Tab structure", {
    totalTabs: tabNames.length,
    tabNames,
    structure
  });
</script>
<!-- END TEMPLATE: _pills_nav_content.html -->
