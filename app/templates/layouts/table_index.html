<!-- START TEMPLATE: layouts/table_index.html -->

{#
  Template: table_index.html

  Extends the base layout and renders an index/list view for any entity.

  • title block
      Sets the page <title> via {{ page_title }}.

  • icon_button import
      Reuses macros for consistent action buttons.

  • Header section
      - Optional main heading (entity_title)
      - Global search input
      - Primary action button (Add {{ entity_name }})
      - Extra action buttons block
      - Column selector dropdown

  • Filters panel (optional)
      Renders Filters config via macros.render_filter(filter)
      Includes Apply and Reset controls

  • Table card
      - Optional card header/title
      - table_actions block for additional controls
      - AG-Grid container initialized via data attributes:
          • data-api-url: grid data endpoint
          • data-entity-name: used in table.js

  • Scripts
      - AG-Grid core library
      - table.js module for dynamic table setup

  Usage:
    Render with context:
      page_title, entity_name, entity_title,
      entity_base_route, api_url,
      filters (list of filter configs),
      show_heading, show_card_header, show_card_title
#}

{% extends 'layouts/base.html' %}
{% import '_macros.html' as macros %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="card mb-4 shadow-sm">
  <div class="container-fluid mt-3">
    <div class="row mb-3">
      <div class="col-12 d-flex align-items-center">
        {% if show_heading|default(true) %}
          <h1 class="h3 mb-0 me-auto">{{ entity_title|default('Items') }}</h1>
        {% endif %}

        <div class="d-flex align-items-center">
          <div class="input-group input-group-sm me-2" style="width: 150px;">
            <span class="input-group-text"><i class="fas fa-search"></i></span>
            <input type="text" id="globalSearch" class="form-control" placeholder="Search...">
          </div>

          {% block action_buttons %}
            {{ macros.icon_button(url_for(entity_base_route + '.create'), 'btn btn-sm btn-primary', 'plus', 'Add ' + entity_name|default('Item')) }}
          {% endblock %}

          {% block extra_action_buttons %}{% endblock %}

          <div class="dropdown ms-2">
            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="columnSelectorBtn" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-columns me-1"></i> Columns
            </button>
            <div class="dropdown-menu p-3" style="width: 250px;" aria-labelledby="columnSelectorBtn">
              <div class="d-flex justify-content-between mb-2">
                <button id="selectAllColumns" class="btn btn-sm btn-outline-primary">Select All</button>
                <button id="clearAllColumns" class="btn btn-sm btn-outline-secondary">Clear All</button>
              </div>
              <div id="columnSelectorItems" class="mt-2">
                <!-- Column checkboxes will be added here dynamically -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% if filters is defined and filters|length > 0 %}
      <div class="filter-panel card border-0 shadow-sm mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center py-2">
          <h5 class="mb-0 fs-6 fw-semibold">Filters</h5>
          <button class="btn btn-sm btn-outline-secondary" id="clearAllFilters" type="button">
            <i class="fas fa-times me-1"></i> Clear All
          </button>
        </div>
        <div class="card-body p-3">
          <form id="tableFilters" class="row g-3" method="GET" action="">
            {% for filter in filters %}
              {{ macros.render_filter(filter) }}
            {% endfor %}

            <div class="col-12 mt-3">
              <button type="submit" class="btn btn-sm btn-primary"><i class="fas fa-filter me-1"></i> Apply Filters</button>
              <a href="{{ request.path }}" class="btn btn-sm btn-outline-secondary"><i class="fas fa-undo me-1"></i> Reset Filters</a>
            </div>
          </form>
        </div>
      </div>
    {% endif %}

    <div class="row">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          {% if show_card_header|default(true) %}
            <div class="card-header bg-light py-2 border-bottom d-flex flex-wrap align-items-center">
              {% if show_card_title|default(false) %}
                <h5 class="mb-0 me-3 fs-6 fw-semibold">{{ entity_title|default('Items') }} List</h5>
              {% endif %}
              <div class="ms-auto d-flex gap-2">
                {% block table_actions %}{% endblock %}
              </div>
            </div>
          {% endif %}

          <div class="card-body p-0">
            <div id="table-container"
                 class="ag-theme-alpine"
                 data-api-url="{{ api_url|default('') }}"
                 data-entity-name="{{ entity_name|default('item') }}"
                 style="height: 600px; width: 100%;">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/31.0.1/ag-grid-community.min.js"></script>
<script type="module" src="{{ url_for('static', filename='js/components/table.js') }}"></script>
{% endblock %}


<!-- END TEMPLATE: layouts/table_index.html -->