{% extends "create_view_edit/components/_create_view_edit.html" %}

{% block content %}
  <div class="tab-content">
    {% for tab in ui %}
      <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
           id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
           role="tabpanel"
           aria-labelledby="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab">
        {% for section in tab.sections %}
          <h5 class="mt-3">{{ section.section_name }}</h5>
          <div class="row">
            {% for entry in section.entries %}
              {{ macros.render_field(entry) }}
            {% endfor %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>

  {% include 'base/components/_autocomplete.html' %}
  {% include 'base/components/_footer.html' %}

  {% if error_message %}
    <script type="module">
      import { showToast } from "/static/js/toasts.js";
      import log from "/static/js/logger.js";
      document.addEventListener('DOMContentLoaded', () => {
        const message = {{ ("Error creating " ~ model_name ~ ": " ~ error_message) | tojson }};
        showToast(message, "error");
        log("error", "create.html", "form_init", "‚ùå Error on create page", message);
      });
    </script>
  {% endif %}

  <script type="module">
    import { initAutoCompleteFields } from "/static/js/autoComplete.js";
    initAutoCompleteFields();
  </script>

  <script type="module">
    import log from "/static/js/logger.js";
    const context = {
      mode: "create",
      model: {{ model_name | tojson }},
      fieldTabs: {{ ui | map(attribute='tab_name') | list | tojson }},
      totalFields: {{ ui | sum(attribute='sections') | map(attribute='entries') | map('length') | sum }}
    };
    log("info", "create.html", "render", "üìã Create form loaded", context);
  </script>
{% endblock %}
