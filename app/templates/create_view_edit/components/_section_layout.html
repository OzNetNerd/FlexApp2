<!-- START TEMPLATE: _section_layout.html -->
{# Import the field macros - adjust the path if your macros are located elsewhere #}
{% import 'create_view_edit/macros/render_field.html' as field_macros with context %}

{% if tabs %}
  <ul class="nav nav-tabs mb-3" id="formTabs" role="tablist">
    {%- for tab in tabs %}
      <li class="nav-item" role="presentation">
        <button class="nav-link {% if loop.first %}active{% endif %}"
                id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
                type="button"
                role="tab">
          {{ tab.tab_name }}
        </button>
      </li>
    {%- endfor %}
  </ul>

  <div class="tab-content" id="formTabsContent">
    {%- for tab in tabs %}
      <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
           id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
           role="tabpanel">
        {%- for section in tab.sections %}
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-white">
              <h5 class="h6 text-primary fw-semibold mb-0">
                {{ section.section_name or 'General' }}
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                {%- for field in section.entries %}
                  {%- if field.entry_name == 'crisp' and read_only %}
                    {% include 'components/_crisp.html' with context %}
                  {%- else %}
                    {{ field_macros.render_field(field, read_only) }}
                  {%- endif %}
                {%- endfor %}
              </div>
            </div>
          </div>
        {%- endfor %}
      </div>
    {%- endfor %}
  </div>

  <script type="module">
    import log from "{{ url_for('static', filename='js/logger.js') }}";

    const scriptName = '_section_layout.html';
    const functionName = 'template_render';

    const tabSummaries = {{ tabs | map(attribute='tab_name') | list | tojson | safe }};
    log("info", scriptName, functionName, "üß© Tabs rendered:", tabSummaries);

    {%- for tab in tabs %}
      {% set section_names = [] %}
      {%- for section in tab.sections %}
        {% set _ = section_names.append(section.section_name) %}
      {%- endfor %}
      const sectionsInTab_{{ loop.index }} = {{ section_names | tojson | safe }};
      log("debug", scriptName, functionName, "üìÅ Sections in tab '{{ tab.tab_name }}':", sectionsInTab_{{ loop.index }});
    {%- endfor %}
  </script>
{% else %}
  <div class="alert alert-warning">
    No tabs available for display.
  </div>
  <script type="module">
    import log from "{{ url_for('static', filename='js/logger.js') }}";
    log("warn", "_section_layout.html", "template_render", "‚ö†Ô∏è No tabs passed into template.");
  </script>
{% endif %}
<!-- END TEMPLATE: _section_layout.html -->