<!-- START TEMPLATE: _tabs_and_sections.html -->
{#
  ------------------------------------------------------------------------------
  File: _tabs_and_sections.html
  Purpose:
    Renders a UI layout using your pre-defined list of Tab objects (`ui`), each
    with named sections and field entries. Uses Bootstrap 5 card layout.
  Inputs:
    - ui: List[Tab]
  Context:
    - read_only: bool
    - field: macro namespace (with render_field)
  Notes:
    - Replaces legacy `fields` grouping logic
    - Uses `_section_card.html` to render each section
    - Logs tab/section structure for debugging
  ------------------------------------------------------------------------------


{# ðŸ§­ Render layout: Tabbed if multiple tabs, stacked otherwise #}
{% if ui | length > 1 %}
  <div class="tab-content" id="formTabsContent">
    {% for tab in ui %}
      <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
           id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
           role="tabpanel"
           aria-labelledby="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab">
        {% for section in tab.sections %}
          {% set _section = section.section_name %}
          {% set _section_fields = section.entries %}
          {% include 'create_view_edit/components/_section_card.html' %}
        {% endfor %}
      </div>
    {% endfor %}
  </div>
{% else %}
  {% for tab in ui %}
    {% for section in tab.sections %}
      {% set _section = section.section_name %}
      {% set _section_fields = section.entries %}
      {% include 'create_view_edit/components/_section_card.html' %}
    {% endfor %}
  {% endfor %}
{% endif %}

<!-- ðŸ§¾ Logging Tab + Section Structure -->
<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";

  const structure = [
    {% for tab in ui %}
      {
        tab: {{ tab.tab_name | tojson }},
        sectionCount: {{ tab.sections | length }},
        fieldCounts: {
          {% for section in tab.sections %}
            {{ section.section_name | tojson }}: {{ section.entries | length }}{% if not loop.last %},{% endif %}
          {% endfor %}
        }
      }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];

  log("info", "_tabs_and_sections.html", "render", "ðŸ§­ Tab/Section structure", {
    totalTabs: structure.length,
    structure
  });
</script>
<!-- END TEMPLATE: _tabs_and_sections.html -->
#}