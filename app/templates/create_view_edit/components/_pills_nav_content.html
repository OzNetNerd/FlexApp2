<!-- START TEMPLATE: _pills_nav_content.html -->
{# ------------------------------------------------------------------------------
  File: _pills_nav_content.html | Purpose: Render pill navigation for tabbed content
  Inputs:
    - ui: List[Dict] â†’ Contains tab configuration objects
  Notes:
    - Works in conjunction with tab_content.html
    - Creates pill navigation using Bootstrap nav-pills
------------------------------------------------------------------------------ #}

<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";
  log("info", "_pills_nav_content.html", "init", "ðŸš€ Pills navigation template loaded");
  log("debug", "_pills_nav_content.html", "config", "UI config exists: {{ ui is defined and ui is not none }}");
</script>

{% if ui %}
  <script type="module">
    import log from "{{ url_for('static', filename='js/logger.js') }}";
    log("debug", "_pills_nav_content.html", "tabs", "Number of tabs: {{ ui|length }}");
    {% for tab in ui %}
      log("debug", "_pills_nav_content.html", "tab_info", "Tab {{ loop.index }}: {{ tab.tab_name }}");
    {% endfor %}
  </script>

  <ul class="nav nav-pills mb-3" id="tab-pills" role="tablist">
    {% for tab in ui %}
      <script type="module">
        import log from "{{ url_for('static', filename='js/logger.js') }}";
        log("debug", "_pills_nav_content.html", "render_pill", "Rendering pill for tab: {{ tab.tab_name }} ({{ loop.index }}/{{ ui|length }})");
      </script>

      <li class="nav-item" role="presentation">
        <button class="nav-link {% if loop.first %}active{% endif %}"
                id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab"
                data-bs-toggle="pill"
                data-bs-target="#tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
                type="button"
                role="tab"
                aria-controls="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
                aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
          {% if tab.icon %}
            <i class="fas fa-{{ tab.icon }} me-1"></i>
          {% endif %}
          {{ tab.tab_name }}
        </button>
        <script type="module">
          import log from "{{ url_for('static', filename='js/logger.js') }}";
          log("debug", "_pills_nav_content.html", "pill_state", "Pill {{ tab.tab_name }} initial state: {% if loop.first %}active{% else %}inactive{% endif %}");
          {% if tab.icon %}
            log("debug", "_pills_nav_content.html", "pill_icon", "Pill has icon: fa-{{ tab.icon }}");
          {% endif %}
        </script>
      </li>
    {% endfor %}
  </ul>

  <script type="module">
    import log from "{{ url_for('static', filename='js/logger.js') }}";
    log("info", "_pills_nav_content.html", "nav_rendered", "All pills navigation rendered successfully");

    // Check pill activation on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      const activePill = document.querySelector('#tab-pills .nav-link.active');
      if (activePill) {
        log("info", "_pills_nav_content.html", "active_pill", "Active pill: " + activePill.textContent.trim());
        log("debug", "_pills_nav_content.html", "active_pill_target", "Target content: " + activePill.getAttribute('data-bs-target'));
      } else {
        log("error", "_pills_nav_content.html", "active_pill", "No active pill found");
      }

      // Verify pills are visible and properly styled
      const pills = document.querySelectorAll('#tab-pills .nav-link');
      if (pills.length > 0) {
        log("debug", "_pills_nav_content.html", "pills_count", `Found ${pills.length} pills in DOM`);
        
        // Check if Bootstrap styles are applied
        const firstPill = pills[0];
        const computedStyle = window.getComputedStyle(firstPill);
        const hasBootstrapStyles = computedStyle.borderRadius !== '0px';
        
        if (hasBootstrapStyles) {
          log("debug", "_pills_nav_content.html", "styles", "Bootstrap styles properly applied to pills");
        } else {
          log("warn", "_pills_nav_content.html", "styles", "Bootstrap styles may not be applied correctly to pills");
        }
      } else {
        log("error", "_pills_nav_content.html", "pills_count", "No pills found in DOM");
      }
    });

    // Monitor pill switching
    document.addEventListener('shown.bs.tab', event => {
      const pillId = event.target.id;
      const targetId = event.target.getAttribute('data-bs-target');
      log("info", "_pills_nav_content.html", "pill_switched", `Tab switched to: ${event.target.textContent.trim()} (${pillId} â†’ ${targetId})`);
    });
  </script>
{% else %}
  <div class="alert alert-info">
    No UI configuration available for navigation.
  </div>
  <script type="module">
    import log from "{{ url_for('static', filename='js/logger.js') }}";
    log("warn", "_pills_nav_content.html", "no_ui", "No UI configuration available for navigation");
  </script>
{% endif %}

<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";
  log("info", "_pills_nav_content.html", "final", "âœ… Pills navigation template finished rendering");

  // Additional DOM verification
  document.addEventListener('DOMContentLoaded', () => {
    // Check if pills are properly linked to tab content
    const pills = document.querySelectorAll('#tab-pills .nav-link');
    let missingTargets = 0;
    
    pills.forEach(pill => {
      const targetId = pill.getAttribute('data-bs-target');
      if (targetId) {
        const targetElement = document.querySelector(targetId);
        if (!targetElement) {
          log("warn", "_pills_nav_content.html", "validation", `Pill targets missing tab content: ${targetId}`);
          missingTargets++;
        }
      }
    });
    
    if (missingTargets === 0 && pills.length > 0) {
      log("info", "_pills_nav_content.html", "validation", "All pills correctly target existing tab content");
    }

    // Check for Bootstrap and event handlers
    if (typeof bootstrap === 'undefined') {
      log("error", "_pills_nav_content.html", "deps", "Bootstrap JS not loaded - pill switching may not work");
    } else {
      log("debug", "_pills_nav_content.html", "deps", "Bootstrap JS loaded successfully");
    }
  });
</script>
<!-- END TEMPLATE: _pills_nav_content.html -->