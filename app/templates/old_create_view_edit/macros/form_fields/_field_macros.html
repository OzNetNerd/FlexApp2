<!-- START TEMPLATE: _field_macros.html -->

{% macro render_field(entry=None, entry_name=None, label=None, type='text', value='', required=False, options=None, read_only=False) %}
  {# If no entry is provided, build one from keyword arguments #}
  {% if entry is none %}
    {% set entry = {
      "entry_name": entry_name,
      "label": label or (entry_name|capitalize),
      "type": type,
      "value": value,
      "required": required,
      "options": options or []
    } %}
  {% endif %}

  <div class="mb-3">
    <label for="{{ entry.entry_name }}" class="form-label">{{ entry.label }}</label>

    {% if read_only %}
      <div class="form-control-plaintext bg-light border rounded px-3 py-2">
        {% if entry.type == 'checkbox' %}
          <i class="fas fa-{{ 'check' if entry.value else 'times' }}"></i>
          {{ 'Yes' if entry.value else 'No' }}
        {% elif entry.type == 'select' and entry.options %}
          {# Loop through options to display the label for the current value #}
          {% for option in entry.options %}
            {% if entry.value == option.value %}
              {{ option.label }}
            {% endif %}
          {% endfor %}
        {% else %}
          {{ entry.value if entry.value is not none else '' }}
        {% endif %}
      </div>
    {% else %}
      {% if entry.type == 'textarea' %}
        <textarea class="form-control" name="{{ entry.entry_name }}" id="{{ entry.entry_name }}"
                  {% if entry.required %}required{% endif %}>
          {{ entry.value or '' }}
        </textarea>
      {% elif entry.type == 'select' and entry.options %}
        <select class="form-select" name="{{ entry.entry_name }}" id="{{ entry.entry_name }}"
                {% if entry.required %}required{% endif %}>
          <option value="">-- Select {{ entry.label }} --</option>
          {% for option in entry.options %}
            <option value="{{ option.value }}" {% if entry.value == option.value %}selected{% endif %}>
              {{ option.label }}
            </option>
          {% endfor %}
        </select>
      {% elif entry.type == 'checkbox' %}
        <div class="form-check">
          <input type="checkbox" class="form-check-input" name="{{ entry.entry_name }}" id="{{ entry.entry_name }}"
                 {% if entry.value %}checked{% endif %}>
          <label class="form-check-label" for="{{ entry.entry_name }}">{{ entry.label }}</label>
        </div>
      {% else %}
        {# For custom types we default to a text input; you may add more cases here #}
        <input type="{{ 'text' if entry.type == 'custom' else entry.type }}" class="form-control"
               name="{{ entry.entry_name }}" id="{{ entry.entry_name }}"
               value="{{ entry.value or '' }}" {% if entry.required %}required{% endif %}>
      {% endif %}
    {% endif %}
  </div>
{% endmacro %}

<!-- END TEMPLATE: _field_macros.html -->
