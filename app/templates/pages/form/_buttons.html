{#
  ------------------------------------------------------------------------------
  File: _buttons.html
  Purpose:
    Renders contextual action buttons for entity pages based on view mode
    and item presence (e.g. view, edit, delete, back, cancel, add).

  Inputs (expected in context):
    - item: Optional[Model]
        The object being displayed, edited, or deleted.
    - read_only: bool
        If True, user is in view-only mode. Buttons adjust accordingly.

  Features:
    - Bootstrap 5 buttons with contextual styling and icons
    - Delete button uses Bootstrap modal trigger for confirmation
    - Logs rendered buttons using logger.js for traceability

  Button Logic:
    - If `item` and not `read_only`:
        Show "Cancel" button to return to view page
    - If `item` and `read_only`:
        Show buttons: Add, Edit, Delete (modal), Back

  Notes:
    - Assumes `#deleteModal` is rendered elsewhere if Delete is shown
    - Uses `request.endpoint` to infer the correct route base
  ------------------------------------------------------------------------------
#}

<div class="d-flex justify-content-end align-items-center gap-2">
  {% if item and not read_only %}
    <a href="{{ url_for(request.endpoint.rsplit('.', 1)[0] + '.view', item_id=item.id) }}"
       class="btn btn-secondary bg-opacity-75 fw-semibold text-white">
      <i class="fas fa-times me-1"></i> Cancel
    </a>
  {% elif item and read_only %}
    <a href="{{ url_for(request.endpoint.rsplit('.', 1)[0] + '.create') }}"
       class="btn btn-primary fw-bold">
      <i class="fas fa-plus me-1"></i> Add
    </a>
    <a href="{{ url_for(request.endpoint.rsplit('.', 1)[0] + '.edit', item_id=item.id) }}"
       class="btn btn-warning text-dark fw-bold">
      <i class="fas fa-edit me-1"></i> Edit
    </a>
    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
      <i class="fas fa-trash me-1"></i> Delete
    </button>
    <a href="{{ url_for(request.endpoint.rsplit('.', 1)[0] + '.index') }}"
       class="btn btn-secondary bg-opacity-75 fw-semibold text-white">
      <i class="fas fa-arrow-left me-1"></i> Back
    </a>
  {% endif %}
</div>

<!-- ðŸ§¾ Button Context Logging -->
<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";

  const context = {
    hasItem: {{ 'true' if item else 'false' }},
    readOnly: {{ read_only | tojson | safe }},
    buttons: []
  };

  if (context.hasItem && !context.readOnly) {
    context.buttons.push("Cancel");
  } else if (context.hasItem && context.readOnly) {
    context.buttons.push("Add", "Edit", "Delete", "Back");
  }

  log("info", "_buttons.html", "render", "ðŸ”˜ Button render context", context);
</script>
