<!-- START TEMPLATE: _autocomplete.html -->
{# ------------------------------------------------------------------------------
  File: _autocomplete.html | Purpose: Render user/company autocomplete fields
  Inputs:
    - initial_user_ids: List[int] for users
    - initial_company_id: Optional[int] for the company
  Features:
    - Bootstrap inputs for user/company with data-initial JSON
    - JS logs and parses initial values
  Notes:
    - Hydrated by autoComplete.js
    - Logs success and parse errors for diagnostics
------------------------------------------------------------------------------ #}

<!-- 👥 Autocomplete Field: Users -->
<div class="mb-3">
  <label for="users-input" class="form-label">Users</label>
  <input
    type="text"
    id="users-input"
    class="form-control"
    placeholder="Type to search users..."
    data-initial='{{ initial_user_ids | default([]) | tojson }}'
  >
</div>

<!-- 🏢 Autocomplete Field: Company -->
<div class="mb-3">
  <label for="companies-input" class="form-label">Company</label>
  <input
    type="text"
    id="companies-input"
    class="form-control"
    placeholder="Type to search companies..."
    data-initial='{{ [initial_company_id] if initial_company_id else [] | tojson }}'
  >
</div>

<!-- 🧾 Autocomplete Initialization Logging -->
<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";
  import { initAutoCompleteFields } from "{{ url_for('static', filename='js/autoComplete.js') }}";

  document.addEventListener('DOMContentLoaded', () => {
    const usersInitial = document.getElementById("users-input")?.dataset.initial || "[]";
    const companiesInitial = document.getElementById("companies-input")?.dataset.initial || "[]";

    let parsedUsers = [], parsedCompany = [];
    try {
      parsedUsers = JSON.parse(usersInitial);
      parsedCompany = JSON.parse(companiesInitial);
    } catch (e) {
      log("error", "_autocomplete.html", "parse", "❌ Failed to parse initial values", e);
    }

    log("info", "_autocomplete.html", "init", "👥 Initial user IDs", parsedUsers);
    log("info", "_autocomplete.html", "init", "🏢 Initial company ID", parsedCompany);

    // Initialize autocomplete fields
    console.log("🚀 Initializing autocomplete fields from template");
    initAutoCompleteFields();
  });
</script>
<!-- END TEMPLATE: _autocomplete.html -->