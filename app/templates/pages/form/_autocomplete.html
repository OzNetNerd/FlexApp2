{#
  ------------------------------------------------------------------------------
  File: _autocomplete.html
  Purpose:
    Renders autocomplete-enabled input fields for selecting users and a company.
    Pre-populates inputs with initial values from the provided `item` context
    and logs initial state for diagnostics.

  Inputs (expected in context):
    - item: Optional[Model]
        Object containing `.users` (List[User]) and `.company` (Company)

  Features:
    - Bootstrap-styled form inputs with unique IDs and labels
    - JS-compatible `data-initial` attribute stores selected IDs in JSON format
    - JS logger tracks initialization and parses stored values

  JavaScript:
    - Parses `data-initial` attributes to ensure JSON is valid
    - Logs parsed values for developers to verify autocomplete behavior
    - Logs JSON parsing errors if malformed data is encountered

  Notes:
    - Inputs are hydrated and enhanced by `autoComplete.js`
    - Compatible with async/autosuggest-style user/company pickers
  ------------------------------------------------------------------------------
#}

<!-- üë• Autocomplete Field: Users -->
<div class="mb-3">
  <label for="users-input" class="form-label">Users</label>
  <input
    type="text"
    id="users-input"
    class="form-control"
    placeholder="Type to search users..."
    data-initial='{{ item.users | map(attribute="id") | list | tojson }}'
  >
</div>

<!-- üè¢ Autocomplete Field: Company -->
<div class="mb-3">
  <label for="companies-input" class="form-label">Company</label>
  <input
    type="text"
    id="companies-input"
    class="form-control"
    placeholder="Type to search companies..."
    data-initial='[{{ item.company.id if item and item.company else "" }}]'
  >
</div>

<!-- üßæ Autocomplete Initialization Logging -->
<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";

  document.addEventListener('DOMContentLoaded', () => {
    const usersInitial = document.getElementById("users-input")?.dataset.initial || "[]";
    const companiesInitial = document.getElementById("companies-input")?.dataset.initial || "[]";

    let parsedUsers = [], parsedCompany = [];
    try {
      parsedUsers = JSON.parse(usersInitial);
      parsedCompany = JSON.parse(companiesInitial);
    } catch (e) {
      log("error", "_autocomplete.html", "parse", "‚ùå Failed to parse initial values", e);
    }

    log("info", "_autocomplete.html", "init", "üë• Initial user IDs", parsedUsers);
    log("info", "_autocomplete.html", "init", "üè¢ Initial company ID", parsedCompany);
  });
</script>
