{% set tabs = {} %}
{% for field in fields %}
  {% set tab = field.tab or 'Other' %}
  {% if tab not in tabs %}
    {% set _ = tabs.update({tab: []}) %}
  {% endif %}
  {% set _ = tabs[tab].append(field) %}
{% endfor %}

{% if tabs|length > 1 %}
  <div class="tab-content" id="formTabsContent">
    {% for tab, tab_fields in tabs.items() %}
      <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
           id="tab-{{ tab | lower | replace(' ', '-') }}"
           role="tabpanel"
           aria-labelledby="tab-{{ tab | lower | replace(' ', '-') }}-tab">

        {% set grouped_by_section = tab_fields | groupby('section') %}
        {% for section, section_fields in grouped_by_section %}
          {% set _section = section %}
          {% set _section_fields = section_fields %}
          {% include 'pages/form/_section_card.html' %}
        {% endfor %}

      </div>
    {% endfor %}
  </div>
{% else %}
  {% for tab, tab_fields in tabs.items() %}
    {% set grouped_by_section = tab_fields | groupby('section') %}
    {% for section, section_fields in grouped_by_section %}
      {% set _section = section %}
      {% set _section_fields = section_fields %}
      {% include 'pages/form/_section_card.html' %}
    {% endfor %}
  {% endfor %}
{% endif %}
