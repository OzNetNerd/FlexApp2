{#
  ------------------------------------------------------------------------------
  File: _section_card.html
  Purpose:
    Renders a Bootstrap 5 card for a logical section of a form, such as
    "Details", "Preferences", or "Settings". Displays a heading and
    a grid of fields using responsive layout.

  Inputs (expected in context):
    - _section         : str
        The name of the section (e.g., "General", "Preferences")
    - _section_fields  : List[Field]
        List of fields to display in this section
    - read_only        : bool
        If true, disables inputs and shows display values
    - field            : Jinja macro namespace
        Provides `field.render_field()` for rendering each field

  Features:
    - Bootstrap-styled card with header and padded body
    - Responsive `.row.g-3` layout for grouped fields
    - Conditional rendering of CRISP section via component
    - JS logging of render context (section name, field count, mode)

  Safety:
    - Assumes `_section_fields` is a list of valid field objects
    - Falls back to "General" if `_section` is not provided

  Notes:
    - Requires `macros.field.render_field` or compatible interface in `field`
    - Should be used within a tabbed or section-based form layout
  ------------------------------------------------------------------------------
#}

<div class="card shadow-sm border-0 mb-4">
  <div class="card-header bg-white">
    <h5 class="h6 text-primary fw-semibold mb-0">
      {{ _section or 'General' }}
    </h5>
  </div>
  <div class="card-body">
    <div class="row g-3">
      {% for field_item in _section_fields %}
        {% if field_item.name == 'crisp' and read_only %}
          {% include 'shared/components/_crisp.html' with context %}
        {% else %}
          {{ field.render_field(field_item, read_only) }}
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<!-- ðŸ§¾ Logging Section Render Context -->
<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";

  const sectionName = {{ (_section or 'General') | tojson | safe }};
  const fieldCount = {{ _section_fields | length }};
  const isReadOnly = {{ read_only | tojson | safe }};

  log("info", "_section_card.html", "render", "ðŸ“¦ Section rendered", {
    section: sectionName,
    fieldCount: fieldCount,
    readOnly: isReadOnly
  });
</script>
