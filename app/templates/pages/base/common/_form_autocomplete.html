<!-- Autocomplete Fields -->
<div class="mb-3">
    <label for="users-input" class="form-label">Users</label>
    <input
      type="text"
      id="users-input"
      class="form-control"
      placeholder="Type to search users..."
      data-initial='{{ item.users | map(attribute="id") | list | tojson }}'
    >
  </div>

  <div class="mb-3">
    <label for="companies-input" class="form-label">Company</label>
    <input
      type="text"
      id="companies-input"
      class="form-control"
      placeholder="Type to search companies..."
      data-initial='[{{ item.company.id if item and item.company else "" }}]'
    >
  </div>

  {% block scripts %}
    {{ super() }}
    <script type="module">
      import { setupAutoComplete } from "{{ url_for('static', filename='js/autoComplete.js') }}";

      const usersInput = document.querySelector('#users-input');
      const usersInitial = JSON.parse(usersInput?.dataset.initial || '[]');

      setupAutoComplete({
        inputSelector: '#users-input',
        dataUrl: '/users/data',
        inputName: 'users',
        initialIds: usersInitial
      });

      const companiesInput = document.querySelector('#companies-input');
      const companiesInitial = JSON.parse(companiesInput?.dataset.initial || '[]');

      setupAutoComplete({
        inputSelector: '#companies-input',
        dataUrl: '/companies/data',
        inputName: 'company_id',
        initialIds: companiesInitial
      });
    </script>
  {% endblock %}
