<!-- START TEMPLATE: edit.html -->

{% extends "pages/page_templates/_create_view_edit_template.html" %}

{% block create_view_edit_content %}
  <form method="POST" id="edit-form">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
        <h3 class="h4 mb-0 text-primary">
          <i class="fas fa-edit me-2"></i>
          {{ title }}
        </h3>
        <div class="small text-muted">
          Endpoint: {{ request.endpoint | default('Not Available', true) }} |
          Type: {{ item_type | default('Not Available', true) }} |
          ID: {{ id | default('Not Available', true) }}
        </div>
      </div>
      <div class="card-body">
        <!-- Tab content -->
        <div class="tab-content">
          {% for tab in ui %}
            <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
                id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
                role="tabpanel"
                aria-labelledby="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab">
              {% for section in tab.sections %}
                <h5 class="mt-3">{{ section.section_name }}</h5>
                {% for entry in section.entries %}
                  {{ macros.render_field(entry) }}
                {% endfor %}
              {% endfor %}
            </div>
          {% endfor %}
        </div>

        <!-- Footer Buttons Include -->
        <div data-template="_footer_buttons.html">
          {% include 'base/common/_footer_buttons.html' %}
        </div>
      </div>
    </div>
  </form>

  <!-- Unsaved changes confirmation modal -->
  <div class="modal fade" id="unsavedChangesModal" tabindex="-1" aria-labelledby="unsavedChangesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="unsavedChangesModalLabel">Unsaved Changes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          You have unsaved changes. Are you sure you want to leave?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Stay on Page</button>
          <button type="button" class="btn btn-primary" id="confirmLeaveBtn">Leave Without Saving</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/js/pages/edit.js"></script>

  <!-- Include main debug panel -->
  {% with
    template_name="edit.html",
    debug_id="edit",
    debug_title="Edit Form Debug",
    debug_data={
      "item_type": item_type|default('N/A'),
      "id": id|default('N/A'),
      "ui_defined": ui is defined,
      "ui_not_none": ui is defined and ui is not none,
      "ui_length": ui|length if ui is defined and ui is not none else 0,
      "title": title|default('N/A'),
      "endpoint": request.endpoint|default('N/A')
    }
  %}
    {% include 'base/core/_debug_panel.html' %}
  {% endwith %}
{% endblock %}