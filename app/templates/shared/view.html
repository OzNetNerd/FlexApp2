{#
  ------------------------------------------------------------------------------
  File: view.html
  Purpose:
    Extends the base entity page layout and includes a modal for delete
    confirmation. This page is typically used to display a read-only view
    of an entity's details with a delete option.

  Template Structure:
    - Extends:
        ‚Ä¢ pages/base/entity_page.html
    - Imports:
        ‚Ä¢ macros/form_fields.html (for possible field rendering needs)
    - Blocks:
        ‚Ä¢ content: Injects custom content into the base page
        ‚Ä¢ Modal: Bootstrap modal for confirming item deletion

  Inputs (expected in context):
    - item      : The object being viewed (must have an `id` for delete URL)
    - request   : Flask request context (used to resolve route for deletion)

  Output:
    - A Bootstrap modal (`#deleteModal`) for confirming item deletion.
      When confirmed, redirects to the `*.delete` endpoint with the item ID.

  Example Use:
    Typically rendered for read-only detail views, where users can
    optionally delete the entity via a confirmation dialog.

  Notes:
    - Modal visibility is triggered externally (e.g., via a button with
      `data-bs-toggle="modal"` and `data-bs-target="#deleteModal"`).
    - Make sure `item` is defined in the context or the delete URL will break.
    - Use in conjunction with `_buttons.html` for edit/delete controls.
  ------------------------------------------------------------------------------
#}

{% extends "pages/base/entity_page.html" %}
{% import "macros/form_fields.html" as macros %}

{% block content %}
{{ super() }}

<div class="tab-content">
  {% for tab in tabs %}
    <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
         id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
         role="tabpanel"
         aria-labelledby="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab">

      {% for section in tab.sections %}
        <h5 class="mt-3">{{ section.section_name }}</h5>
        {% for entry in section.entries %}
          {{ macros.render_field(entry) }}
        {% endfor %}
      {% endfor %}

    </div>
  {% endfor %}
</div>

<!-- Logging for View Page Context -->
<script type="module">
  import log from "{{ url_for('static', filename='js/logger.js') }}";

  const viewContext = {
    entityId: {{ item.id if item else 'null' }},
    title: {{ title | default("null") | tojson | safe }},
    totalTabs: {{ tabs | length }},
    tabSummary: [
      {% for tab in tabs %}
        {
          tab: {{ tab.tab_name | tojson }},
          sections: {{ tab.sections | length }},
          totalEntries: {{ tab.sections | sum(attribute='entries' | length) }}
        }{% if not loop.last %},{% endif %}
      {% endfor %}
    ]
  };

  log("info", "view.html", "render", "üîç View page initialized", viewContext);
</script>
{% endblock %}
