{# ------------------------------------------------------------------------------
  File: ui_components.html | Purpose: Reusable UI components and elements
  Description:
    - Consolidates UI-related templates into a single file
    - Includes tabs, pills, notifications, entity displays, and activity notes
    - Provides consistent UI elements across the application

  Macros:
    - render_tab_section: Creates a tabbed section with content
    - render_pills_content: Renders pill navigation with content panels
    - render_entity_table: Displays a table of related entities
    - render_entity_list: Shows a list of related entities
    - render_notes: Displays activity notes in a card
------------------------------------------------------------------------------ #}

{% macro render_tab_section(tab_id, title, active=false) %}
<div class="tab-pane fade {% if active %}show active{% endif %}" id="tab-{{ tab_id }}">
  <div class="section-card card shadow-sm border-0 mb-4">
    <div class="section-header">
      <h5 class="section-heading">{{ title }}</h5>
    </div>
    <div class="section-body">
      <div class="row g-3">
        {{ caller() }}
      </div>
    </div>
  </div>
</div>
{% endmacro %}

{% macro render_pills_content(tabs) %}
  {% for tab in tabs %}
    <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
         id="tab-{{ tab.tab_name | lower | replace(' ', '-') }}"
         role="tabpanel"
         aria-labelledby="tab-{{ tab.tab_name | lower | replace(' ', '-') }}-tab">

      {% if tab.sections %}
        {% for section in tab.sections %}
          <div class="card mb-3">
            {% if section.section_name %}
              <div class="card-header">
                {% if section.icon %}
                  <i class="fas fa-{{ section.icon }} me-1"></i>
                {% endif %}
                {{ section.section_name }}
              </div>
            {% endif %}

            <div class="card-body">
              {% if section.entries %}
                <div class="row">
                  {% for entry in section.entries %}
                    {{ forms.render_field(entry, read_only=read_only) }}
                  {% endfor %}
                </div>
              {% else %}
                <div class="alert alert-light">No form fields defined for this section.</div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="alert alert-light">No sections defined for this tab.</div>
      {% endif %}
    </div>
  {% endfor %}
{% endmacro %}

{% macro render_empty_state(message) %}
  <div class="form-control-plaintext bg-light border rounded px-3 py-2">
    {{ message }}
  </div>
{% endmacro %}

{% macro render_entity_table(entities, entity_type, columns, link_prefix) %}
  <div class="col-12">
    <label class="form-label fw-semibold">{{ entity_type }}</label>
    {% if entities %}
      <div class="table-responsive form-control-plaintext bg-light border rounded px-3 py-2">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              {% for column in columns %}
                <th>{{ column.label }}</th>
              {% endfor %}
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for entity in entities %}
            <tr>
              {% for column in columns %}
                <td>
                  {% if column.type == 'badge' %}
                    {% set badge_class = 'bg-secondary' %}
                    {% if column.badge_mapping and entity[column.key] in column.badge_mapping %}
                      {% set badge_class = column.badge_mapping[entity[column.key]] %}
                    {% endif %}
                    <span class="badge {{ badge_class }}">
                      {{ entity[column.key]|default('') }}
                    </span>
                  {% elif column.type == 'currency' %}
                    ${{ entity[column.key]|default('0.00') }}
                  {% else %}
                    {{ entity[column.key]|default('') }}
                  {% endif %}
                </td>
              {% endfor %}
              <td>
                <a href="{{ link_prefix }}/{{ entity.id }}" class="btn btn-sm btn-info">
                  <i class="fas fa-eye"></i>
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      {{ render_empty_state('No ' + entity_type|lower + ' associated with this entity.') }}
    {% endif %}
  </div>
{% endmacro %}

{% macro render_entity_list(entities, entity_type) %}
  <div class="col-12">
    <label class="form-label fw-semibold">{{ entity_type }}</label>
    {% if entities %}
      <div class="form-control-plaintext bg-light border rounded px-3 py-2">
        <div class="list-group list-group-flush">
          {% for entity in entities %}
            <div class="list-group-item bg-transparent px-0 border-0 border-bottom">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">{{ entity.name }}</h5>
              </div>
              {% if entity.description %}
                <p class="mb-1">{{ entity.description }}</p>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      {{ render_empty_state('No ' + entity_type|lower + ' defined for this entity.') }}
    {% endif %}
  </div>
{% endmacro %}

{% macro render_notes(notes) %}
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h2 class="h5 mb-0">Recent Activity</h2>
          <button class="btn btn-sm btn-outline-primary">View All</button>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            {% for note in notes %}
              <li class="list-group-item d-flex align-items-center border-0 border-bottom py-3">
                <div class="activity-icon {{ note.icon_bg_class }} text-white d-flex align-items-center justify-content-center">
                  <i class="{{ note.icon_class }}"></i>
                </div>
                <div class="ms-3">
                  <p class="mb-0">{{ note.description|safe }}</p>
                  <small class="text-muted">{{ note.timestamp }}</small>
                 </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
{% endmacro %}

<style>
  /* Activity Icons */
  .activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Section headings */
  .section-heading {
    padding: 10px 0;
    margin-bottom: 16px;
    border-bottom: 1px solid #eee;
  }

  /* Tab content styling */
  .tab-pane {
    padding-top: 20px;
  }

  /* Card styling for tab content */
  .section-card {
    padding: 20px;
    background-color: #fff;
  }
</style>